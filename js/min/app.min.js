const JSON_FILES=["dumped/json/client_dll.json","dumped/json/buttons.json","dumped/json/engine2_dll.json","dumped/json/offsets.json","dumped/json/schemasystem_dll.json"];let allClasses={},sortedClassNames=[],searchCache=new Map,lastQuery="",searchInput=null;const stripComments=e=>e.replace(/\/\/.*$/gm,"").replace(/\/\*[\s\S]*?\*\//g,""),readLocalJSON=e=>new Promise(((t,s)=>{const n=new XMLHttpRequest;n.open("GET",e,!0),n.onload=()=>200===n.status||0===n.status?t(JSON.parse(stripComments(n.responseText))):s(`HTTP ${n.status}`),n.onerror=()=>s("Network error"),n.send()}));async function fetchData(){const e="file:"===location.protocol;for(const t of JSON_FILES)try{let s;if(e)s=await readLocalJSON(t);else{const e=await fetch(t);if(!e.ok)continue;s=JSON.parse(stripComments(await e.text()))}if(t.includes("schemasystem_dll.json")){const e=s[Object.keys(s)[0]];e.classes&&Object.assign(allClasses,e.classes),allClasses["[SchemaSystem]"]={fields:{},parent:"Global Types"};const t=allClasses["[SchemaSystem]"].fields,n=e.classes?.CSchemaSystemInternalRegistration;n?.fields&&Object.entries(n.fields).forEach((([e,s])=>{t[e]={offset:s,type_name:"builtin"}}));continue}const n=s[Object.keys(s)[0]];n?.classes&&Object.assign(allClasses,n.classes),t.includes("offsets.json")&&(allClasses.MoonLightGlobals??={fields:{},parent:"Global Types"},Object.entries(s).forEach((([e,t])=>{allClasses.MoonLightGlobals.fields[e]={type_name:"module",offsets:t}})))}catch(e){console.error(`Failed to load ${t}:`,e)}sortedClassNames=Object.keys(allClasses).sort(((e,t)=>e.localeCompare(t)));const t=sortedClassNames.indexOf("MoonLightGlobals");t>-1&&(sortedClassNames.splice(t,1),sortedClassNames.unshift("MoonLightGlobals")),console.log("Moonlight loaded:",sortedClassNames.length,"classes"),renderClassList("")}function getMatchingClasses(e){if(!e)return sortedClassNames;if(e=e.trim().toLowerCase(),searchCache.has(e))return searchCache.get(e);const[t,s]=e.startsWith("class:")?["class",e.slice(6).trim()]:e.startsWith("offset:")?["offset",e.slice(7).trim()]:e.startsWith("enum:")?["enum",e.slice(5).trim()]:["all",e],n=[];for(const e of sortedClassNames){const o=allClasses[e];let a=!1;if("class"===t)e.toLowerCase().includes(s)&&(a=!0);else if("enum"===t&&"[SchemaSystem]"===e)a=Object.keys(o.fields||{}).some((e=>e.toLowerCase().includes(s)));else if("offset"===t&&o.fields){for(const e of Object.values(o.fields))if(e?.offsets&&Object.keys(e.offsets).some((e=>e.toLowerCase().includes(s)))){a=!0;break}}else if(e.toLowerCase().includes(s)&&(a=!0),!a&&o.fields)for(const[e,t]of Object.entries(o.fields))if(e.toLowerCase().includes(s)||t?.type_name&&t.type_name.toLowerCase().includes(s)||t?.enum_values&&Object.keys(t.enum_values).some((e=>e.toLowerCase().includes(s)))){a=!0;break}a&&n.push(e)}return searchCache.size>500&&searchCache.clear(),searchCache.set(e,n),n}function renderClassList(e=""){lastQuery=e;const t=document.getElementById("classlist");t.innerHTML="";const s=document.createDocumentFragment(),n=getMatchingClasses(e);let o=null;for(const e of n){const t=allClasses[e],n=document.createElement("div");n.className="class-item",n.onclick=()=>selectClass(e,n);const a=document.createElement("span");a.className="name",a.textContent=e.replace(/^\[|\]$/g,"");const c=document.createElement("span");c.className="parent",c.textContent=t.parent||("[SchemaSystem]"===e?"Global Types":""),n.appendChild(a),n.appendChild(c),o||(o=n),s.appendChild(n)}t.appendChild(s),e&&o&&setTimeout((()=>{o.click(),o.scrollIntoView({block:"center",behavior:"smooth"})}),10)}const formatHex=e=>"number"==typeof e?"0x"+e.toString(16).toUpperCase():"string"==typeof e&&/^-?\d+$/.test(e)?"0x"+Number(e).toString(16).toUpperCase():e??"?";function selectClass(e,t){document.querySelectorAll(".class-item").forEach((e=>e.classList.remove("active"))),t?.classList.add("active");const s=document.getElementById("content");s.innerHTML="";const n=allClasses[e]||{},o=document.createElement("h1");if(o.className="class-title",o.innerHTML=`${e.replace(/^\[|\]$/g,"")}${n.parent?` <span class="parent">: ${n.parent}</span>`:""}`,s.appendChild(o),"[SchemaSystem]"===e){const e=document.createElement("div");e.className="card",e.innerHTML='<strong class="section-title">Schema</strong>';const t=document.createElement("table");t.innerHTML="<thead><tr><th>Name</th><th>Type</th><th>Size/Offset</th><th>Values</th></tr></thead><tbody></tbody>";const o=t.querySelector("tbody");return Object.entries(n.fields||{}).forEach((([e,t])=>{let s="";if(t.enum_values){const e=Object.entries(t.enum_values).map((([e,t])=>`<code>${e}</code> = ${t}`)).join(", ");s=`<details><summary>${Object.keys(t.enum_values).length} values</summary><div style="margin-top:8px;font-size:12px;">${e}</div></details>`}const n=document.createElement("tr");n.innerHTML=`\n        <td><code>${e}</code></td>\n        <td><code>${t.type_name||"builtin"}</code></td>\n        <td><code>${void 0!==t.offset?formatHex(t.offset):t.size?t.size+"B":"?"}</code></td>\n        <td>${s}</td>\n      `,o.appendChild(n)})),e.appendChild(t),s.appendChild(e),void lucide?.createIcons()}if(n.fields&&Object.keys(n.fields).length){const e=document.createElement("div");e.className="card",e.innerHTML='<strong class="section-title">Fields</strong>';if(Object.values(n.fields).some((e=>e?.offsets)))for(const[t,s]of Object.entries(n.fields)){if(!s?.offsets)continue;const n=document.createElement("details");n.open=!0;const o=document.createElement("summary");o.textContent=t,n.appendChild(o);const a=document.createElement("div");a.className="type-note",a.textContent=s.type_name||"unknown",n.appendChild(a);const c=document.createElement("table");c.innerHTML="<thead><tr><th>Offset Name</th><th>Value</th></tr></thead><tbody></tbody>";const l=c.querySelector("tbody");for(const[e,t]of Object.entries(s.offsets||{})){const s=document.createElement("tr");s.innerHTML=`<td><code>${e}</code></td><td><code>${formatHex(t)}</code></td>`,l.appendChild(s)}n.appendChild(c),e.appendChild(n)}else{const t=document.createElement("table");t.innerHTML="<thead><tr><th>Field</th><th>Offset</th></tr></thead><tbody></tbody>";const s=t.querySelector("tbody");for(const[e,t]of Object.entries(n.fields)){const n="object"==typeof t?t.offset??"?":t,o=document.createElement("tr");o.innerHTML=`<td><code>${e}</code></td><td><code>${formatHex(n)}</code></td>`,s.appendChild(o)}e.appendChild(t)}s.appendChild(e)}if(n.methods&&Object.keys(n.methods).length){const e=document.createElement("div");e.className="card",e.innerHTML='<strong class="section-title">Methods</strong>';const t=document.createElement("table");t.innerHTML="<thead><tr><th>Name</th><th>Return</th><th>Arguments</th></tr></thead><tbody></tbody>";const o=t.querySelector("tbody");for(const[e,t]of Object.entries(n.methods)){const s=(t.args||[]).map((e=>`${e.type_name||"?"} ${e.name||""}`)).filter(Boolean).join(", ")||"void",n=document.createElement("tr");n.innerHTML=`<td><code>${e}</code></td><td><code>${t.return_type||"void"}</code></td><td><code>${s}</code></td>`,o.appendChild(n)}e.appendChild(t),s.appendChild(e)}n.fields||n.methods||(s.innerHTML+='<div class="card"><em>No data available.</em></div>'),lucide?.createIcons()}function debouncedSearch(){const e=searchInput.value;e!==lastQuery&&renderClassList(e)}window.addEventListener("DOMContentLoaded",(()=>{let e;fetchData(),searchInput=document.getElementById("search-input"),searchInput.addEventListener("input",(()=>{clearTimeout(e),e=setTimeout(debouncedSearch,100)}))}));